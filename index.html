<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>On-Chain</title>
    <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ctext y='90' font-size='90'%3E%C2%A9%3C/text%3E%3C/svg%3E">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');

        :root {
            --coinstats-bg: #12141c;
            --coinstats-card: #1e2029;
            --coinstats-text: #e0e0e0;
            --coinstats-accent: #6c63ff;
            --binance-bg: #1e222d;
            --binance-card: #2b3139;
            --binance-primary: #f0b90b;
            --binance-text: #eaecef;
            --binance-secondary-text: #848e9c;
            --green-trade: #45b26b;
            --red-trade: #ef4444;
            --binance-border: #363a45;
        }

        body {
            font-family: 'Inter', sans-serif;
            transition: background-color 0.3s, color 0.3s;
        }

        .landing-page {
            background-color: var(--coinstats-bg);
            color: var(--coinstats-text);
        }

        .main-app {
            background-color: var(--binance-bg);
            color: var(--binance-text);
        }

        .coinstats-card {
            background-color: var(--coinstats-card);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .binance-card {
            background-color: var(--binance-card);
            border: 1px solid var(--binance-border);
        }

        .btn-primary {
            background-color: var(--coinstats-accent);
            color: white;
            padding: 1rem 2rem;
            border-radius: 9999px;
            font-weight: 600;
            transition: background-color 0.3s;
        }

        .btn-primary:hover {
            background-color: #5a54cc;
        }

        .how-it-works-item {
            display: flex;
            align-items: flex-start;
            gap: 1.5rem;
        }

        .step-number {
            font-size: 2rem;
            font-weight: 700;
            color: var(--coinstats-accent);
        }

        .faq-item details {
            background-color: var(--coinstats-card);
            padding: 1.5rem;
            border-radius: 0.75rem;
            cursor: pointer;
        }

        .faq-item summary {
            font-weight: 600;
            font-size: 1.125rem;
            color: var(--coinstats-text);
        }

        .faq-item[open] summary {
            color: var(--coinstats-accent);
        }

        /* Binance-specific styles */
        .binance-header {
            background-color: var(--binance-bg);
            border-bottom: 1px solid var(--binance-border);
        }

        .binance-footer {
            background-color: var(--binance-bg);
            border-top: 1px solid var(--binance-border);
        }

        .nav-item {
            color: var(--binance-secondary-text);
        }

        .nav-item.active {
            color: var(--binance-primary);
        }

        .asset-list-item {
            border-bottom: 1px solid var(--binance-border);
        }

        .trade-button {
            background-color: var(--binance-primary);
            color: black;
            font-weight: 600;
        }

        /* Modal styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.75);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 50;
        }

        .modal-content {
            background-color: var(--coinstats-card);
            padding: 2rem;
            border-radius: 1rem;
            max-width: 90%;
            width: 500px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            position: relative;
        }

        .close-modal {
            position: absolute;
            top: 1rem;
            right: 1rem;
            color: var(--coinstats-text);
            cursor: pointer;
            font-size: 1.5rem;
        }

        .qr-code {
            border: 2px solid white;
        }
    </style>
</head>
<body class="transition-colors duration-300">

    <!-- PWA Manifest (Inline JSON) -->
    <script type="application/json" id="manifest">
    {
      "name": "On-Chain App",
      "short_name": "On-Chain",
      "start_url": "./",
      "display": "standalone",
      "background_color": "#12141c",
      "theme_color": "#6c63ff",
      "description": "Your on-chain crypto terminal and portfolio manager.",
      "icons": [
        {
          "src": "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ctext y='90' font-size='90'%3E%C2%A9%3C/text%3E%3C/svg%3E",
          "sizes": "192x192",
          "type": "image/svg+xml"
        },
        {
          "src": "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ctext y='90' font-size='90'%3E%C2%A9%3C/text%3E%3C/svg%3E",
          "sizes": "512x512",
          "type": "image/svg+xml"
        }
      ]
    }
    </script>

    <!-- Page Containers -->
    <div id="landingPage" class="landing-page min-h-screen">
        <!-- Landing Page Content (CoinStats Style) -->
        <header class="py-6 px-4 flex justify-between items-center text-white">
            <h1 class="text-3xl font-bold">Â© On-Chain</h1>
            <div class="space-x-4">
                <button id="getAppBtn" class="bg-gray-800 text-white font-medium py-2 px-4 rounded-full border border-gray-700 hover:bg-gray-700 transition-colors">Get App</button>
                <button id="connectWalletBtn" class="bg-blue-600 text-white font-medium py-2 px-4 rounded-full hover:bg-blue-700 transition-colors">Connect Wallet</button>
            </div>
        </header>

        <main>
            <section class="py-20 px-4 text-center">
                <h2 class="text-5xl font-extrabold text-white mb-4">Your On-Chain Crypto Terminal</h2>
                <p class="text-xl text-gray-400 mb-8 max-w-2xl mx-auto">
                    Track markets, manage your portfolio, and trade with real-time data powered by the CoinGecko API.
                </p>
                <div class="flex flex-col sm:flex-row justify-center items-center space-y-4 sm:space-y-0 sm:space-x-4">
                    <button id="exploreMoreBtn" class="bg-blue-600 text-white font-medium py-3 px-8 rounded-full hover:bg-blue-700 transition-colors">
                        Explore More
                    </button>
                    <button id="searchBtn" class="text-gray-400 font-medium py-3 px-8 rounded-full border border-gray-700 hover:bg-gray-800 transition-colors">
                        Search
                    </button>
                </div>
            </section>

            <!-- Market Overview & Price List (CoinGecko API) -->
            <section class="py-16 px-4 bg-[#1e2029] text-white">
                <h2 class="text-3xl font-bold text-center mb-12">Market Overview & Top Coins</h2>
                <div id="marketDataContainer" class="max-w-7xl mx-auto grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                    <!-- Data will be dynamically injected here -->
                </div>
                <div id="coinListContainer" class="max-w-7xl mx-auto mt-12 overflow-x-auto">
                    <!-- Coin List will be dynamically injected here -->
                </div>
            </section>

            <!-- How it Works Section -->
            <section id="how-it-works" class="py-16 px-4 bg-gray-900-coinstats">
                <h2 class="text-4xl font-bold text-center mb-12 text-blue-300">How It Works</h2>
                <div class="max-w-5xl mx-auto space-y-12">
                    <div class="how-it-works-item">
                        <div class="step-number">1.</div>
                        <div>
                            <h3 class="text-3xl font-semibold mb-3">Connect Your Wallet</h3>
                            <p class="text-gray-300 text-lg">Securely link your existing crypto wallet using WalletConnect or a browser extension like MetaMask. We support various networks.</p>
                        </div>
                    </div>
                    <div class="how-it-works-item">
                        <div class="step-number">2.</div>
                        <div>
                            <h3 class="text-3xl font-semibold mb-3">Explore Markets</h3>
                            <p class="text-gray-300 text-lg">Dive into our comprehensive market overview with real-time price updates and interactive charts for your favorite cryptocurrencies.</p>
                        </div>
                    </div>
                    <div class="how-it-works-item">
                        <div class="step-number">3.</div>
                        <div>
                            <h3 class="text-3xl font-semibold mb-3">Trade & Manage</h3>
                            <p class="text-gray-300 text-lg">Effortlessly execute buy and sell orders, track your portfolio performance, and view your transaction history all in one place.</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Call to Action Section -->
            <section class="py-16 px-4 bg-gray-950-coinstats text-center">
                <h2 class="text-4xl font-bold text-blue-300 mb-6">Ready to Get Started?</h2>
                <p class="text-xl text-gray-300 mb-8 max-w-3xl mx-auto">
                    Join thousands of users who trust OnChain for their crypto trading and portfolio management needs.
                </p>
                <button id="cta-connect-wallet-btn" class="landing-cta btn-primary">
                    Connect Wallet & Start Trading
                </button>
            </section>

            <!-- FAQ Section -->
            <section id="faq" class="py-16 px-4 bg-gray-900-coinstats">
                <h2 class="text-4xl font-bold text-center mb-12 text-blue-300">Frequently Asked Questions</h2>
                <div class="max-w-4xl mx-auto space-y-6">
                    <!-- FAQ Item 1 -->
                    <div class="faq-item">
                        <details>
                            <summary>
                                What is OnChain?
                            </summary>
                            <p class="text-gray-300 mt-3">
                                OnChain is a sophisticated crypto terminal that allows you to track market data, connect your wallet, and simulate crypto trades in real-time.
                            </p>
                        </details>
                    </div>
                    <!-- FAQ Item 2 -->
                    <div class="faq-item">
                        <details>
                            <summary>
                                Is my wallet secure?
                            </summary>
                            <p class="text-gray-300 mt-3">
                                Yes, we use industry-standard secure connection methods like WalletConnect and MetaMask. Your private keys never leave your wallet.
                            </p>
                        </details>
                    </div>
                    <!-- FAQ Item 3 -->
                    <details>
                        <summary>
                            Do you support real trading?
                        </summary>
                        <p class="text-gray-300 mt-3">
                            Currently, OnChain provides a simulation environment for trading. It's perfect for practicing strategies without real financial risk.
                        </p>
                    </details>
                </div>
            </section>

        </main>

        <!-- Footer -->
        <footer class="bg-gray-950-coinstats py-10 px-4 text-center text-gray-400 text-sm">
            <div class="max-w-7xl mx-auto flex flex-col md:flex-row justify-between items-center space-y-4 md:space-y-0">
                <p>&copy; 2024 OnChain. All rights reserved.</p>
                <div class="flex space-x-6">
                    <a href="#" class="hover:text-white transition-colors duration-200">Privacy Policy</a>
                    <a href="#" class="hover:text-white transition-colors duration-200">Terms of Service</a>
                    <a href="#" class="hover:text-white transition-colors duration-200">Support</a>
                </div>
            </div>
        </footer>
    </div>

    <!-- Main App (Binance Style) - Hidden by default -->
    <div id="mainApp" class="main-app hidden flex flex-col h-screen">
        <!-- Main app HTML content will be dynamically injected here after wallet connection -->
    </div>

    <!-- Modals -->
    <!-- Wallet Connect Modal -->
    <div id="walletConnectModal" class="modal-overlay hidden">
        <div class="modal-content text-center">
            <span class="close-modal">&times;</span>
            <h2 class="text-2xl font-bold mb-6">Connect Your Wallet</h2>
            <div class="space-y-4">
                <button id="metamaskConnect" class="w-full p-4 rounded-lg flex items-center justify-between coinstats-card hover:bg-gray-800 transition-colors">
                    <span class="font-semibold">MetaMask</span>
                    <i class="fas fa-wallet"></i>
                </button>
                <button id="walletConnect" class="w-full p-4 rounded-lg flex items-center justify-between coinstats-card hover:bg-gray-800 transition-colors">
                    <span class="font-semibold">WalletConnect</span>
                    <i class="fas fa-qrcode"></i>
                </button>
                <button id="manualConnect" class="w-full p-4 rounded-lg flex items-center justify-between coinstats-card hover:bg-gray-800 transition-colors">
                    <span class="font-semibold">Manual Connect</span>
                    <i class="fas fa-keyboard"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- Manual Connect Sub-Modal -->
    <div id="manualConnectModal" class="modal-overlay hidden">
        <div class="modal-content text-center">
            <span class="close-modal">&times;</span>
            <h2 class="text-2xl font-bold mb-6">Manual Connect</h2>
            <div class="space-y-4">
                <select id="networkSelect" class="w-full p-2 rounded bg-gray-700 text-white focus:outline-none">
                    <option value="ETH">Ethereum</option>
                    <option value="BSC">Binance Smart Chain</option>
                    <option value="POLYGON">Polygon</option>
                    <option value="ARBITRUM">Arbitrum</option>
                </select>
                <input id="walletAddressInput" type="text" placeholder="Enter Wallet Address" class="w-full p-2 rounded bg-gray-700 text-white focus:outline-none">
                <button id="manualConnectSubmit" class="w-full px-4 py-2 bg-blue-600 text-white rounded-lg font-semibold">Connect</button>
            </div>
        </div>
    </div>

    <!-- Deposit Modal -->
    <div id="depositModal" class="modal-overlay hidden">
        <div class="modal-content text-center">
            <span class="close-modal">&times;</span>
            <h2 class="text-2xl font-bold mb-6">Deposit</h2>
            <div class="space-y-4">
                <div class="bg-gray-700 p-4 rounded-lg">
                    <h3 class="font-bold text-lg mb-2">ETH Address</h3>
                    <img id="ethQrCode" class="qr-code mx-auto" alt="ETH QR Code">
                    <p class="text-xs break-all mt-2">0xAB98294614C46008cBF82Fa3e25285FBC2A6F257</p>
                </div>
                <div class="bg-gray-700 p-4 rounded-lg">
                    <h3 class="font-bold text-lg mb-2">BTC Address</h3>
                    <img id="btcQrCode" class="qr-code mx-auto" alt="BTC QR Code">
                    <p class="text-xs break-all mt-2">bc1q9ldrkd44xk9xlg3qgefx5avhl7hwlfaqaktsmx</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Withdrawal Modal -->
    <div id="withdrawModal" class="modal-overlay hidden">
        <div class="modal-content text-center">
            <span class="close-modal">&times;</span>
            <h2 class="text-2xl font-bold mb-6">Withdraw USDT</h2>
            <form id="withdrawForm">
                <input id="withdrawAddress" type="text" placeholder="Recipient Address" class="w-full p-2 rounded bg-gray-700 text-white focus:outline-none mb-3">
                <select id="withdrawNetwork" class="w-full p-2 rounded bg-gray-700 text-white focus:outline-none mb-3">
                    <option value="ETH">Ethereum</option>
                    <option value="BSC">Binance Smart Chain</option>
                </select>
                <div class="flex items-center mb-3">
                    <input id="withdrawAmount" type="text" placeholder="Amount" class="flex-grow p-2 rounded bg-gray-700 text-white focus:outline-none">
                    <button type="button" id="withdrawMax" class="ml-2 px-4 py-2 bg-gray-600 text-white rounded">Max</button>
                </div>
                <div class="text-left text-sm text-gray-400 mb-3">
                    <p>Gas Fee: <span id="gasFee">0.13868213 BNB</span></p>
                    <p>Total Balance: <span id="withdrawBalance">$6,878.78 USDT</span></p>
                </div>
                <button type="submit" class="w-full px-4 py-2 bg-red-600 text-white rounded-lg font-semibold">Confirm Withdrawal</button>
            </form>
        </div>
    </div>

    <!-- Withdrawal Confirmation Modal -->
    <div id="withdrawConfirmModal" class="modal-overlay hidden">
        <div class="modal-content text-center">
            <span class="close-modal">&times;</span>
            <h2 class="text-2xl font-bold mb-6">Confirm Withdrawal</h2>
            <p class="text-gray-400 mb-4">Please enter the transaction hash to confirm.</p>
            <input id="txHashInput" type="text" placeholder="Transaction Hash" class="w-full p-2 rounded bg-gray-700 text-white focus:outline-none mb-4">
            <button id="confirmTxBtn" class="w-full px-4 py-2 bg-binance-primary text-black rounded-lg font-semibold">Confirm</button>
        </div>
    </div>

    <!-- Withdrawal Processing Modal -->
    <div id="withdrawProcessingModal" class="modal-overlay hidden">
        <div class="modal-content text-center">
            <span class="close-modal">&times;</span>
            <h2 class="text-2xl font-bold mb-6">Withdrawal in Progress</h2>
            <p id="processingMessage" class="text-gray-400 mb-4">Please wait for the transaction to be processed.</p>
            <p class="text-lg font-bold">24-hour Countdown: <span id="countdownTimer"></span></p>
        </div>
    </div>

    <!-- Withdrawal Success Modal -->
    <div id="withdrawSuccessModal" class="modal-overlay hidden">
        <div class="modal-content text-center">
            <span class="close-modal">&times;</span>
            <h2 class="text-2xl font-bold mb-6 text-green-trade">Withdrawal Successful!</h2>
            <p class="text-gray-400">Your transaction has been confirmed and saved to your history.</p>
        </div>
    </div>

    <!-- Font Awesome for icons -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js"></script>

    <!-- QR Code library -->
    <script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>

    <!-- Main JavaScript Logic -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {

            /* ============================  
               CONFIG & NETWORK CATALOG  
            ============================ */
            const CONFIG = {
                INFURA_ID: "c35d1ef971da479b918c9900134867d4",
                WALLETCONNECT_PROJECT_ID: "cedd3cec8430b2990ce3fe466ecb1a29",
                MORALIS_API_KEY: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJub25jZSI6ImUzZmNjNmVlLTVmYTItNGI5OC1hYzAwLTVjNjJlOGI4NTVmNiIsIm9yZ0lkIjoiNDY1MjI1IiwidXNlcklkIjoiNDc4NjE5IiwidHlwZUlkIjoiYmZmYTEwYzctMjQ4MC00ZjFhLWJkYmUtMmU2ZGY0ZDNiOGU2IiwidHlwZSI6IlBST0pFQ1QiLCJpYXQiOjE3NTUyMjY1NDgsImV4cCI6NDkxMDk4NjU0OH0.Z0-grx3kR0tfWAt8qbkt5xlgvBGsXuybm5j05ZwK0Tc", 
                ETHERSCAN_API_KEY: "VZFDUWB3YGQ1YCDKTCU1D6DDSS",
                ETHERSCAN_API_URL: "https://api.etherscan.io/api",
                BSCSCAN_API_KEY: "ZM8ACMJB67C2IXKKBF8URFUNSY",
                BSCSCAN_API_URL: "https://api.bscscan.com/api",
                ARBISCAN_API_KEY: "B6SVGA7K3YBJEQ69AFKJF4YHVX",
                ARBISCAN_API_URL: "https://api.arbiscan.io/api",
                SNOWSCAN_API_KEY: "ATJQERBKV1CI3GVKNSE3Q7RGEJ",
                SNOWSCAN_API_URL: "https://api.snowscan.xyz/api",
                OPTIMISM_API_KEY: "66N5FRNV1ZD4I87S7MAHCJVXFJ",
                OPTIMISM_API_URL: "https://api-optimistic.etherscan.io/api",
                CRYPTOAPIS_API_KEY: "11256eb482c92bc78682c5635052761bd4bcfa8b",
                COINGECKO_BASE: "https://api.coingecko.com/api/v3",
                COINGECKO_NEWS_BASE: "https://api.coingecko.com/api/v3/onchain/news"
            };

            const DEPOSIT = {
                ETH: "0xAB98294614C46008cBF82Fa3e25285FBC2A6F257",
                BSC: "0xAB98294614C46008cBF82Fa3e25285FBC2A6F257",
                POLYGON: "0xAB98294614C46008cBF82Fa3e25285FBC2A6F257",
                ARBITRUM: "0xAB98294614C46008cBF82Fa3e25285FBC2A6F257",
                OPTIMISM: "0xAB98294614C46008cBF82Fa3e25285FBC2A6F257",
                AVAX: "0xAB98294614C46008cBF82Fa3e25285FBC2A6F257",
                SOL: "GwobMFEUFxPH3kfpHjbyCsKcVaPV4ptAePEPdnpHdmn5",
                BTC: "bc1q9ldrkd44xk9xlg3qgefx5avhl7hwlfaqaktsmx"
            };

            let isWalletConnected = false;
            let currentWalletAddress = '';
            
            // UI Elements
            const landingPage = document.getElementById('landingPage');
            const mainApp = document.getElementById('mainApp');
            let pages = []; // Initialize as empty, will be populated after content injection
            
            // Buttons
            const connectWalletBtn = document.getElementById('connectWalletBtn');
            const ctaConnectWalletBtn = document.getElementById('cta-connect-wallet-btn');
            const searchBtn = document.getElementById('searchBtn');

            // Modals
            const walletConnectModal = document.getElementById('walletConnectModal');
            const manualConnectModal = document.getElementById('manualConnectModal');
            const depositModal = document.getElementById('depositModal');
            const withdrawModal = document.getElementById('withdrawModal');
            const withdrawConfirmModal = document.getElementById('withdrawConfirmModal');
            const withdrawProcessingModal = document.getElementById('withdrawProcessingModal');
            const withdrawSuccessModal = document.getElementById('withdrawSuccessModal');
            const allModals = document.querySelectorAll('.modal-overlay');

            // Modal Buttons
            const metamaskConnectBtn = document.getElementById('metamaskConnect');
            const walletConnectBtn = document.getElementById('walletConnect');
            const manualConnectBtn = document.getElementById('manualConnect');
            const manualConnectSubmitBtn = document.getElementById('manualConnectSubmit');
            const withdrawMaxBtn = document.getElementById('withdrawMax');
            const withdrawForm = document.getElementById('withdrawForm');
            const confirmTxBtn = document.getElementById('confirmTxBtn');

            // Helper function to show a specific page and hide others
            const showPage = (pageId) => {
                // Check if pages are already in the DOM, if not, query them
                if (pages.length === 0 || !document.getElementById('homePage')) {
                     pages = document.querySelectorAll('.page');
                }
                
                // Check if pages exist before trying to manipulate their style
                if (pages.length > 0) {
                    pages.forEach(page => {
                        // Safely access style property by checking for null
                        if (page) {
                            page.style.display = 'none';
                        }
                    });
                }
                
                const targetPage = document.getElementById(pageId);
                if (targetPage) {
                    targetPage.style.display = 'block';
                }

                // If markets page is shown, update its content
                if (pageId === 'marketsPage') {
                    fetchAndRenderMarketsPage();
                }
            };

            // Helper to show a modal
            const showModal = (modal) => {
                modal.classList.remove('hidden');
            };

            // Helper to hide all modals
            const hideAllModals = () => {
                allModals.forEach(modal => {
                    modal.classList.add('hidden');
                });
            };

            // Show landing page on initial load
            landingPage.classList.remove('hidden');
            mainApp.classList.add('hidden');

            /* ============================  
               LANDING PAGE LOGIC  
            ============================ */
            const fetchCoinGeckoData = async () => {
                try {
                    const marketOverviewResponse = await fetch(`${CONFIG.COINGECKO_BASE}/global`);
                    if (!marketOverviewResponse.ok) throw new Error('Failed to fetch global market data');
                    const marketOverviewData = await marketOverviewResponse.json();
                    
                    const topCoinsResponse = await fetch(`${CONFIG.COINGECKO_BASE}/coins/markets?vs_currency=usd&order=market_cap_desc&per_page=10&page=1&sparkline=true`);
                    if (!topCoinsResponse.ok) throw new Error('Failed to fetch top coins data');
                    const topCoinsData = await topCoinsResponse.json();

                    // Update market overview
                    const totalMarketCap = (marketOverviewData.data.total_market_cap.usd / 1e12).toFixed(2) + 'T';
                    const totalVolume = (marketOverviewData.data.total_volume.usd / 1e9).toFixed(2) + 'B';
                    
                    const marketDataContainer = document.getElementById('marketDataContainer');
                    if (marketDataContainer) {
                        marketDataContainer.innerHTML = `
                            <div class="coinstats-card rounded-lg p-6 text-center">
                                <p class="text-sm text-gray-400">Total Market Cap</p>
                                <p class="text-2xl font-bold mt-2">$${totalMarketCap}</p>
                            </div>
                            <div class="coinstats-card rounded-lg p-6 text-center">
                                <p class="text-sm text-gray-400">24h Volume</p>
                                <p class="text-2xl font-bold mt-2">$${totalVolume}</p>
                            </div>
                            <div class="coinstats-card rounded-lg p-6 text-center">
                                <p class="text-sm text-gray-400">BTC Dominance</p>
                                <p class="text-2xl font-bold mt-2">${marketOverviewData.data.market_cap_percentage.btc.toFixed(2)}%</p>
                            </div>
                            <div class="coinstats-card rounded-lg p-6 text-center">
                                <p class="text-sm text-gray-400">ETH Dominance</p>
                                <p class="text-2xl font-bold mt-2">${marketOverviewData.data.market_cap_percentage.eth.toFixed(2)}%</p>
                            </div>
                        `;
                    }

                    // Update top coins list
                    let coinListHtml = `
                        <div class="bg-[#24262f] p-4 rounded-lg">
                            <div class="flex font-semibold text-gray-400 pb-2 border-b border-gray-700">
                                <span class="w-1/4">#</span>
                                <span class="w-1/2">Coin</span>
                                <span class="w-1/4 text-right">Price</span>
                            </div>
                    `;
                    
                    topCoinsData.forEach((coin, index) => {
                        const priceChangeClass = coin.price_change_percentage_24h > 0 ? 'text-green-500' : 'text-red-500';
                        coinListHtml += `
                            <div class="flex items-center py-4 border-b border-gray-700 last:border-b-0">
                                <span class="w-1/4">${index + 1}</span>
                                <div class="w-1/2 flex items-center">
                                    <img src="${coin.image}" alt="${coin.name}" class="w-6 h-6 mr-2 rounded-full">
                                    <span>${coin.name}</span>
                                </div>
                                <div class="w-1/4 text-right">
                                    <p class="font-semibold">$${coin.current_price.toFixed(2)}</p>
                                    <p class="text-xs ${priceChangeClass}">${coin.price_change_percentage_24h.toFixed(2)}%</p>
                                </div>
                            </div>
                        `;
                    });

                    coinListHtml += `</div>`;
                    const coinListContainer = document.getElementById('coinListContainer');
                    if (coinListContainer) {
                        coinListContainer.innerHTML = coinListHtml;
                    }

                } catch (error) {
                    console.error("Failed to fetch CoinGecko data:", error);
                    const marketDataContainer = document.getElementById('marketDataContainer');
                    const coinListContainer = document.getElementById('coinListContainer');
                    if (marketDataContainer) {
                        marketDataContainer.innerHTML = `<p class="text-center text-red-500 col-span-4">Failed to load market data. Please try again later.</p>`;
                    }
                    if (coinListContainer) {
                        coinListContainer.innerHTML = `<p class="text-center text-red-500 col-span-4">Failed to load coin list.</p>`;
                    }
                }
            };
            
            fetchCoinGeckoData();

            /* ============================  
               WALLET CONNECTION LOGIC  
            ============================ */
            connectWalletBtn.addEventListener('click', () => {
                showModal(walletConnectModal);
            });
            
            ctaConnectWalletBtn.addEventListener('click', () => {
                showModal(walletConnectModal);
            });

            manualConnectBtn.addEventListener('click', () => {
                hideAllModals();
                showModal(manualConnectModal);
            });

            manualConnectSubmitBtn.addEventListener('click', async () => {
                const walletAddress = document.getElementById('walletAddressInput').value;
                if (walletAddress) {
                    await simulateWalletConnect(walletAddress);
                } else {
                    console.error("Please enter a wallet address.");
                }
            });

            metamaskConnectBtn.addEventListener('click', async () => {
                if (typeof window.ethereum !== 'undefined') {
                    try {
                        const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
                        if (accounts.length > 0) {
                            await simulateWalletConnect(accounts[0]);
                        } else {
                            console.error("No accounts found.");
                        }
                    } catch (error) {
                        console.error("MetaMask connection failed:", error);
                    }
                } else {
                    console.error("MetaMask is not installed.");
                    // In a real app, you would prompt the user to install it
                }
            });

            walletConnectBtn.addEventListener('click', async () => {
                // Simulating WalletConnect logic
                console.log("Simulating WalletConnect...");
                await simulateWalletConnect("0xSimulatedWalletConnectAddress");
            });

            const simulateWalletConnect = (address) => {
                hideAllModals();
                landingPage.classList.add('hidden');
                mainApp.classList.remove('hidden');
                isWalletConnected = true;
                currentWalletAddress = address;
                
                // Show a loading message while content is being injected
                const loadingMessage = `<p class="text-center text-xl text-white">Connecting wallet...</p>`;
                mainApp.innerHTML = loadingMessage;
                
                return new Promise(resolve => {
                    setTimeout(() => {
                        // Dynamically inject the main app's HTML content
                        mainApp.innerHTML = `
                            <!-- Main App Header -->
                            <header class="binance-header p-4 flex items-center justify-between sticky top-0 z-10">
                                <div class="flex items-center space-x-2">
                                    <button class="text-gray-400">Exchange</button>
                                    <span class="text-white font-semibold">|</span>
                                    <button class="text-binance-primary font-semibold">Wallet</button>
                                </div>
                                <div class="flex items-center space-x-4 text-2xl">
                                    <button id="searchAppBtn" class="text-white"><i class="fas fa-search"></i></button>
                                    <button id="notificationsBtn" class="text-white"><i class="fas fa-bell"></i></button>
                                    <button id="settingsBtn" class="text-white"><i class="fas fa-cog"></i></button>
                                    <span id="walletAddressDisplay" class="text-xs font-mono text-gray-400 cursor-pointer"></span>
                                </div>
                            </header>

                            <!-- Main App Pages -->
                            <div id="pagesContainer" class="flex-grow overflow-y-auto p-4 pb-16">
                                <!-- Homepage -->
                                <div id="homePage" class="page">
                                    <h2 class="text-3xl font-bold mb-4">Welcome</h2>
                                    <div class="binance-card rounded-lg p-4 flex justify-between items-center mb-6">
                                        <div>
                                            <p class="text-sm text-gray-400">Total Balance</p>
                                            <p id="totalBalance" class="text-2xl font-bold mt-1">$6,878.78</p>
                                        </div>
                                        <div class="space-x-2">
                                            <button id="homeDepositBtn" class="px-4 py-2 bg-green-trade text-white rounded-lg">Deposit</button>
                                            <button id="homeWithdrawBtn" class="px-4 py-2 bg-red-trade text-white rounded-lg">Withdraw</button>
                                        </div>
                                    </div>
                                    
                                    <!-- Quick Action Buttons -->
                                    <div class="grid grid-cols-4 gap-4 text-center mb-6">
                                        <button id="sendBtn" class="flex flex-col items-center">
                                            <div class="bg-gray-700 w-12 h-12 rounded-full flex items-center justify-center mb-1">
                                                <i class="fas fa-arrow-up text-white"></i>
                                            </div>
                                            <span class="text-xs text-gray-400">Send</span>
                                        </button>
                                        <button id="receiveBtn" class="flex flex-col items-center">
                                            <div class="bg-gray-700 w-12 h-12 rounded-full flex items-center justify-center mb-1">
                                                <i class="fas fa-arrow-down text-white"></i>
                                            </div>
                                            <span class="text-xs text-gray-400">Receive</span>
                                        </button>
                                        <button id="buyCryptoBtn" class="flex flex-col items-center">
                                            <div class="bg-gray-700 w-12 h-12 rounded-full flex items-center justify-center mb-1">
                                                <i class="fas fa-credit-card text-white"></i>
                                            </div>
                                            <span class="text-xs text-gray-400">Buy Crypto</span>
                                        </button>
                                        <button id="referralBtn" class="flex flex-col items-center">
                                            <div class="bg-gray-700 w-12 h-12 rounded-full flex items-center justify-center mb-1">
                                                <i class="fas fa-user-plus text-white"></i>
                                            </div>
                                            <span class="text-xs text-gray-400">Referral</span>
                                        </button>
                                        <button id="savingsBtn" class="flex flex-col items-center">
                                            <div class="bg-gray-700 w-12 h-12 rounded-full flex items-center justify-center mb-1">
                                                <i class="fas fa-piggy-bank text-white"></i>
                                            </div>
                                            <span class="text-xs text-gray-400">Savings</span>
                                        </button>
                                        <button id="stakingBtn" class="flex flex-col items-center">
                                            <div class="bg-gray-700 w-12 h-12 rounded-full flex items-center justify-center mb-1">
                                                <i class="fas fa-cubes text-white"></i>
                                            </div>
                                            <span class="text-xs text-gray-400">Staking</span>
                                        </button>
                                        <button id="launchpadBtn" class="flex flex-col items-center">
                                            <div class="bg-gray-700 w-12 h-12 rounded-full flex items-center justify-center mb-1">
                                                <i class="fas fa-rocket text-white"></i>
                                            </div>
                                            <span class="text-xs text-gray-400">Launchpad</span>
                                        </button>
                                        <button id="moreBtn" class="flex flex-col items-center">
                                            <div class="bg-gray-700 w-12 h-12 rounded-full flex items-center justify-center mb-1">
                                                <i class="fas fa-ellipsis-h text-white"></i>
                                            </div>
                                            <span class="text-xs text-gray-400">More</span>
                                        </button>
                                    </div>

                                    <h3 class="text-xl font-bold mt-8 mb-4">Market Trends</h3>
                                    <div id="topCoinsTable" class="binance-card rounded-lg overflow-x-auto">
                                        <!-- Coin table will be injected here -->
                                    </div>
                                </div>
                                
                                <!-- Markets Page -->
                                <div id="marketsPage" class="page hidden">
                                    <header class="flex items-center space-x-4 mb-4">
                                        <button id="marketsBackBtn" class="text-white text-lg"><i class="fas fa-arrow-left"></i></button>
                                        <h2 class="text-2xl font-bold">Markets</h2>
                                    </header>
                                    <div class="flex items-center space-x-2 mb-4">
                                        <div class="relative w-full">
                                            <input id="marketSearch" type="text" placeholder="Search Markets" class="w-full p-2 pl-10 rounded-lg bg-gray-700 text-white placeholder-gray-400 focus:outline-none">
                                            <i class="fas fa-search absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
                                        </div>
                                        <button class="text-white text-lg"><i class="fas fa-ellipsis-v"></i></button>
                                    </div>

                                    <div id="marketNews" class="mb-6">
                                        <h3 class="text-xl font-bold mb-3">Latest News</h3>
                                        <div id="newsContainer" class="space-y-4">
                                            <!-- News articles will be injected here -->
                                        </div>
                                    </div>

                                    <div id="topGainersLosers" class="mb-6">
                                        <h3 class="text-xl font-bold mb-3">Top Gainers & Losers</h3>
                                        <div class="flex space-x-4 mb-4">
                                            <button id="showGainers" class="px-4 py-2 rounded-full bg-green-trade text-white font-semibold">Top Gainers</button>
                                            <button id="showLosers" class="px-4 py-2 rounded-full bg-gray-600 text-gray-200 font-semibold">Top Losers</button>
                                        </div>
                                        <div id="gainersLosersList" class="binance-card rounded-lg overflow-hidden">
                                            <!-- List will be injected here -->
                                        </div>
                                    </div>

                                    <div id="marketCharts">
                                        <h3 class="text-xl font-bold mb-3">Performance Charts</h3>
                                        <div class="binance-card rounded-lg p-2">
                                            <iframe src="https://tradingview.com/widget/market-overview/" style="width:100%; height:400px; border:none;"></iframe>
                                        </div>
                                    </div>
                                </div>

                                <!-- Trade Page -->
                                <div id="tradePage" class="page hidden">
                                    <h2 class="text-3xl font-bold mb-6">Trade</h2>
                                    <p class="text-gray-400 mb-4">Real-time TradingView chart (simulated).</p>
                                    <div class="binance-card rounded-lg p-2">
                                        <iframe src="https://tradingview.com/widget/market-overview/" style="width:100%; height:400px; border:none;"></iframe>
                                    </div>
                                    <div id="tradeControls" class="mt-6 flex justify-around">
                                        <button class="px-6 py-2 rounded-lg bg-green-trade font-semibold">Buy</button>
                                        <button class="px-6 py-2 rounded-lg bg-red-trade font-semibold">Sell</button>
                                    </div>
                                </div>

                                <!-- Futures Page -->
                                <div id="futuresPage" class="page hidden">
                                    <h2 class="text-3xl font-bold mb-6">Futures</h2>
                                    <p class="text-gray-400">Futures trading page. Currently under construction.</p>
                                </div>

                                <!-- Assets Page -->
                                <div id="assetsPage" class="page hidden">
                                    <h2 class="text-3xl font-bold mb-6">Assets</h2>
                                    <div class="binance-card rounded-lg p-4 flex justify-between items-center">
                                        <div>
                                            <p class="text-sm text-gray-400">Total Balance</p>
                                            <p id="totalBalanceAssets" class="text-2xl font-bold mt-1">$6,878.78 USDT</p>
                                        </div>
                                        <div class="space-x-2">
                                            <button id="assetsDepositBtn" class="px-4 py-2 bg-green-trade text-white rounded-lg">Deposit</button>
                                            <button id="assetsWithdrawBtn" class="px-4 py-2 bg-red-trade text-white rounded-lg">Withdraw</button>
                                        </div>
                                    </div>
                                    <div id="assetList" class="mt-6">
                                        <h3 class="text-xl font-bold mb-4">My Assets</h3>
                                        <div class="binance-card rounded-lg p-4 asset-list-item flex justify-between items-center">
                                            <div>
                                                <p class="font-semibold">Bitcoin</p>
                                                <p class="text-xs text-gray-400">BTC</p>
                                            </div>
                                            <div class="text-right">
                                                <p>$45,000.00</p>
                                                <p class="text-xs text-gray-400">0.05 BTC</p>
                                            </div>
                                        </div>
                                        <div class="binance-card rounded-lg p-4 mt-2 asset-list-item flex justify-between items-center">
                                            <div>
                                                <p class="font-semibold">Ethereum</p>
                                                <p class="text-xs text-gray-400">ETH</p>
                                            </div>
                                            <div class="text-right">
                                                <p>$2,000.00</p>
                                                <p class="text-xs text-gray-400">1.5 ETH</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- New Pages added to the main app -->
                                <div id="sendPage" class="page hidden">
                                    <h2 class="text-3xl font-bold mb-6">Send Crypto</h2>
                                    <p class="text-gray-400">Simulated page for sending assets. Enter recipient and amount.</p>
                                </div>
                                
                                <div id="receivePage" class="page hidden">
                                    <h2 class="text-3xl font-bold mb-6">Receive Crypto</h2>
                                    <p class="text-gray-400">Simulated page for receiving assets. Shows your address.</p>
                                </div>
                                
                                <div id="buyCryptoPage" class="page hidden">
                                    <h2 class="text-3xl font-bold mb-6">Buy Crypto</h2>
                                    <p class="text-gray-400">Simulated page for buying crypto via credit card or bank transfer.</p>
                                </div>
                                
                                <div id="referralPage" class="page hidden">
                                    <h2 class="text-3xl font-bold mb-6">Referral Program</h2>
                                    <p class="text-gray-400">Simulated page for a referral program. Share your link and earn rewards!</p>
                                </div>
                                
                                <div id="savingsPage" class="page hidden">
                                    <h2 class="text-3xl font-bold mb-6">Savings</h2>
                                    <p class="text-gray-400">Simulated page for crypto savings products. Earn interest on your holdings.</p>
                                </div>
                                
                                <div id="stakingPage" class="page hidden">
                                    <h2 class="text-3xl font-bold mb-6">Staking</h2>
                                    <p class="text-gray-400">Simulated page for staking assets. Help secure networks and earn rewards.</p>
                                </div>
                                
                                <div id="launchpadPage" class="page hidden">
                                    <h2 class="text-3xl font-bold mb-6">Launchpad</h2>
                                    <p class="text-gray-400">Simulated page for token launch events. Discover new projects.</p>
                                </div>

                                <div id="morePage" class="page hidden">
                                    <h2 class="text-3xl font-bold mb-6">More</h2>
                                    <p class="text-gray-400">Simulated page for more services and products offered by the exchange.</p>
                                </div>

                                <div id="notificationsPage" class="page hidden">
                                    <h2 class="text-3xl font-bold mb-6">Notifications</h2>
                                    <div id="notificationsList" class="binance-card rounded-lg p-4">
                                        <p class="text-gray-400">No new notifications.</p>
                                    </div>
                                </div>

                                <div id="settingsPage" class="page hidden">
                                    <h2 class="text-3xl font-bold mb-6">Settings</h2>
                                    <div class="binance-card rounded-lg p-4">
                                        <p class="font-semibold">Language</p>
                                        <p class="text-sm text-gray-400">English</p>
                                    </div>
                                    <div class="binance-card rounded-lg p-4 mt-2">
                                        <p class="font-semibold">Theme</p>
                                        <p class="text-sm text-gray-400">Dark Mode</p>
                                    </div>
                                </div>

                                <div id="supportPage" class="page hidden">
                                    <h2 class="text-3xl font-bold mb-6">Support</h2>
                                    <div class="binance-card rounded-lg p-4 mb-4">
                                        <h3 class="font-bold text-xl mb-2">FAQ</h3>
                                        <div class="space-y-4">
                                            <div>
                                                <p class="font-semibold">How do I reset my password?</p>
                                                <p class="text-gray-400 text-sm mt-1">Simulated answer: You can reset your password through the link on the login page.</p>
                                            </div>
                                            <div>
                                                <p class="font-semibold">How do I contact support?</p>
                                                <p class="text-gray-400 text-sm mt-1">Fill out the form below to get in touch with our support team.</p>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="binance-card rounded-lg p-4">
                                        <h3 class="font-bold text-xl mb-2">Contact Support</h3>
                                        <form id="contactForm" action="https://formspree.io/f/mldlqyag" method="POST">
                                            <input type="text" name="name" placeholder="Your Name" class="w-full p-2 rounded bg-gray-700 border-none text-white focus:outline-none mb-3">
                                            <input type="email" name="email" placeholder="Your Email" class="w-full p-2 rounded bg-gray-700 border-none text-white focus:outline-none mb-3">
                                            <textarea name="message" placeholder="Your Message" rows="4" class="w-full p-2 rounded bg-gray-700 border-none text-white focus:outline-none mb-3"></textarea>
                                            <button type="submit" class="w-full px-4 py-2 bg-binance-primary text-black rounded-lg font-semibold">Send Message</button>
                                        </form>
                                    </div>
                                </div>
                            </div>
                            <!-- Main App Footer Navigation -->
                            <footer class="binance-footer flex justify-around items-center p-3 sticky bottom-0">
                                <button id="navHome" class="nav-item active flex flex-col items-center">
                                    <i class="fas fa-home text-xl"></i>
                                    <span class="text-xs mt-1">Home</span>
                                </button>
                                <button id="navMarkets" class="nav-item flex flex-col items-center">
                                    <i class="fas fa-chart-line text-xl"></i>
                                    <span class="text-xs mt-1">Markets</span>
                                </button>
                                <button id="navTrade" class="nav-item flex flex-col items-center">
                                    <i class="fas fa-exchange-alt text-xl"></i>
                                    <span class="text-xs mt-1">Trade</span>
                                </button>
                                <button id="navFutures" class="nav-item flex flex-col items-center">
                                    <i class="fas fa-fire text-xl"></i>
                                    <span class="text-xs mt-1">Futures</span>
                                </button>
                                <button id="navAssets" class="nav-item flex flex-col items-center">
                                    <i class="fas fa-wallet text-xl"></i>
                                    <span class="text-xs mt-1">Assets</span>
                                </button>
                            </footer>
                        `;
                        // After HTML is injected, set up all the event listeners
                        setupMainAppEventListeners();
                        updateUIForConnection(address);
                        showPage('homePage');
                        resolve();
                    }, 1000); // 1-second loading simulation
                });
            };

            const updateUIForConnection = (address) => {
                const walletAddressDisplay = document.getElementById('walletAddressDisplay');
                const shortAddress = `${address.slice(0, 6)}...${address.slice(-4)}`;
                if (walletAddressDisplay) {
                    walletAddressDisplay.innerText = shortAddress;
                    walletAddressDisplay.title = address;
                    walletAddressDisplay.addEventListener('click', () => {
                        // Navigate to Wallet Details Page (simulated)
                        console.log(`Wallet Details Page for ${address}`);
                    });
                }
            };
            
            const fetchAndRenderMainAppHome = async () => {
                 try {
                    const topCoinsResponse = await fetch(`${CONFIG.COINGECKO_BASE}/coins/markets?vs_currency=usd&order=market_cap_desc&per_page=10&page=1&sparkline=true&price_change_percentage=24h`);
                    if (!topCoinsResponse.ok) throw new Error('Failed to fetch top coins for homepage');
                    const topCoinsData = await topCoinsResponse.json();

                    let tableHtml = `
                        <div class="p-4">
                            <div class="flex font-semibold text-gray-400 pb-2 border-b border-binance-border text-sm">
                                <span class="w-1/2">Coin</span>
                                <span class="w-1/4 text-right">Price</span>
                                <span class="w-1/4 text-right">24h Change</span>
                            </div>
                    `;
                    
                    topCoinsData.forEach((coin) => {
                        const priceChangeClass = coin.price_change_percentage_24h > 0 ? 'text-green-trade' : 'text-red-trade';
                        const priceChangeArrow = coin.price_change_percentage_24h > 0 ? 'â²' : 'â¼';
                        tableHtml += `
                            <div class="flex items-center py-4 border-b border-binance-border last:border-b-0 text-sm">
                                <div class="w-1/2 flex items-center">
                                    <img src="${coin.image}" alt="${coin.name}" class="w-6 h-6 mr-2 rounded-full">
                                    <div>
                                        <p class="font-semibold">${coin.symbol.toUpperCase()}</p>
                                        <p class="text-xs text-gray-400">${coin.name}</p>
                                    </div>
                                </div>
                                <div class="w-1/4 text-right">
                                    <p>$${coin.current_price.toFixed(2)}</p>
                                </div>
                                <div class="w-1/4 text-right ${priceChangeClass} flex items-center justify-end">
                                    <span>${priceChangeArrow} ${Math.abs(coin.price_change_percentage_24h).toFixed(2)}%</span>
                                </div>
                            </div>
                        `;
                    });

                    tableHtml += `</div>`;
                    
                    const topCoinsTable = document.getElementById('topCoinsTable');
                    if(topCoinsTable) {
                        topCoinsTable.innerHTML = tableHtml;
                    }

                } catch (error) {
                    console.error("Failed to fetch top coins for main app homepage:", error);
                    const topCoinsTable = document.getElementById('topCoinsTable');
                    if (topCoinsTable) {
                        topCoinsTable.innerHTML = `<p class="text-center text-red-500 py-4">Failed to load market data. Please try again later.</p>`;
                    }
                }
            }
            
            const fetchAndRenderMarketsPage = async () => {
                const newsContainer = document.getElementById('newsContainer');
                const gainersLosersList = document.getElementById('gainersLosersList');
                const marketSearch = document.getElementById('marketSearch');
                const showGainersBtn = document.getElementById('showGainers');
                const showLosersBtn = document.getElementById('showLosers');

                if (!newsContainer || !gainersLosersList) {
                    console.error("Markets page elements not found.");
                    return;
                }

                // Function to fetch and render news
                const fetchAndRenderNews = async () => {
                    newsContainer.innerHTML = `<p class="text-center text-gray-400">Loading news...</p>`;
                    try {
                        const newsResponse = await fetch(`${CONFIG.COINGECKO_BASE}/search/trending`);
                        if (!newsResponse.ok) throw new Error('Failed to fetch trending coins');
                        const newsData = await newsResponse.json();
                        
                        let newsHtml = '';
                        if (newsData.coins && newsData.coins.length > 0) {
                            newsData.coins.forEach(item => {
                                const coin = item.item;
                                newsHtml += `
                                    <div class="binance-card rounded-lg p-3 flex items-center space-x-3">
                                        <img src="${coin.large}" alt="${coin.name}" class="w-8 h-8 rounded-full">
                                        <div>
                                            <p class="font-semibold text-white">${coin.name}</p>
                                            <p class="text-xs text-gray-400">${coin.symbol.toUpperCase()}</p>
                                        </div>
                                    </div>
                                `;
                            });
                        } else {
                             newsHtml = `<p class="text-center text-gray-400">No news available.</p>`;
                        }
                        newsContainer.innerHTML = newsHtml;
                    } catch (error) {
                        console.error("Failed to fetch news:", error);
                        newsContainer.innerHTML = `<p class="text-center text-red-500">Failed to load news.</p>`;
                    }
                };

                // Function to fetch and render top gainers/losers
                const fetchAndRenderGainersLosers = async (type = 'gainers') => {
                    gainersLosersList.innerHTML = `<p class="text-center text-gray-400 py-4">Loading data...</p>`;
                    try {
                        const marketResponse = await fetch(`${CONFIG.COINGECKO_BASE}/coins/markets?vs_currency=usd&order=market_cap_desc&per_page=200&page=1&price_change_percentage=24h`);
                        if (!marketResponse.ok) throw new Error('Failed to fetch market data for gainers/losers');
                        let marketData = await marketResponse.json();

                        const topGainers = marketData.filter(c => c.price_change_percentage_24h > 0).sort((a, b) => b.price_change_percentage_24h - a.price_change_percentage_24h).slice(0, 10);
                        const topLosers = marketData.filter(c => c.price_change_percentage_24h < 0).sort((a, b) => a.price_change_percentage_24h - b.price_change_percentage_24h).slice(0, 10);
                        
                        const coinsToDisplay = type === 'gainers' ? topGainers : topLosers;

                        let listHtml = `
                             <div class="px-4 py-2 flex font-semibold text-gray-400 border-b border-binance-border text-sm">
                                <span class="w-1/2">Coin</span>
                                <span class="w-1/4 text-right">Price</span>
                                <span class="w-1/4 text-right">24h Change</span>
                            </div>
                        `;

                        if (coinsToDisplay.length > 0) {
                            coinsToDisplay.forEach(coin => {
                                const priceChangeClass = coin.price_change_percentage_24h > 0 ? 'text-green-trade' : 'text-red-trade';
                                const priceChangeArrow = coin.price_change_percentage_24h > 0 ? 'â²' : 'â¼';
                                listHtml += `
                                    <div class="flex items-center p-4 border-b border-binance-border last:border-b-0 text-sm">
                                        <div class="w-1/2 flex items-center">
                                            <img src="${coin.image}" alt="${coin.name}" class="w-6 h-6 mr-2 rounded-full">
                                            <div>
                                                <p class="font-semibold">${coin.symbol.toUpperCase()}</p>
                                                <p class="text-xs text-gray-400">${coin.name}</p>
                                            </div>
                                        </div>
                                        <div class="w-1/4 text-right">
                                            <p>$${coin.current_price.toFixed(2)}</p>
                                        </div>
                                        <div class="w-1/4 text-right ${priceChangeClass} flex items-center justify-end">
                                            <span>${priceChangeArrow} ${Math.abs(coin.price_change_percentage_24h).toFixed(2)}%</span>
                                        </div>
                                    </div>
                                `;
                            });
                        } else {
                            listHtml += `<p class="text-center text-gray-400 py-4">No data available.</p>`;
                        }
                        gainersLosersList.innerHTML = listHtml;

                    } catch (error) {
                        console.error("Failed to fetch gainers/losers:", error);
                        gainersLosersList.innerHTML = `<p class="text-center text-red-500 py-4">Failed to load data.</p>`;
                    }
                };

                // Initial load
                fetchAndRenderNews();
                fetchAndRenderGainersLosers('gainers');

                // Button event listeners
                showGainersBtn.addEventListener('click', () => {
                    fetchAndRenderGainersLosers('gainers');
                    showGainersBtn.classList.add('bg-green-trade', 'text-white');
                    showGainersBtn.classList.remove('bg-gray-600', 'text-gray-200');
                    showLosersBtn.classList.remove('bg-red-trade', 'text-white');
                    showLosersBtn.classList.add('bg-gray-600', 'text-gray-200');
                });
                showLosersBtn.addEventListener('click', () => {
                    fetchAndRenderGainersLosers('losers');
                    showLosersBtn.classList.add('bg-red-trade', 'text-white');
                    showLosersBtn.classList.remove('bg-gray-600', 'text-gray-200');
                    showGainersBtn.classList.remove('bg-green-trade', 'text-white');
                    showGainersBtn.classList.add('bg-gray-600', 'text-gray-200');
                });
                
                // Search bar functionality (simulated filtering)
                marketSearch.addEventListener('input', (e) => {
                    const searchTerm = e.target.value.toLowerCase();
                    const listItems = gainersLosersList.querySelectorAll('.flex.items-center.p-4');
                    listItems.forEach(item => {
                        const coinName = item.querySelector('.font-semibold').textContent.toLowerCase();
                        if (coinName.includes(searchTerm)) {
                            item.style.display = 'flex';
                        } else {
                            item.style.display = 'none';
                        }
                    });
                });
            };

            const setupMainAppEventListeners = () => {
                const navButtons = document.querySelectorAll('.nav-item');
                navButtons.forEach(button => {
                    button.addEventListener('click', () => {
                        navButtons.forEach(btn => btn.classList.remove('active'));
                        button.classList.add('active');
                        const pageId = button.id.replace('nav', '').toLowerCase() + 'Page';
                        showPage(pageId);
                    });
                });
                
                // Homepage quick action buttons
                document.getElementById('homeDepositBtn').addEventListener('click', () => showModal(depositModal));
                document.getElementById('homeWithdrawBtn').addEventListener('click', () => showModal(withdrawModal));
                document.getElementById('sendBtn').addEventListener('click', () => showPage('sendPage'));
                document.getElementById('receiveBtn').addEventListener('click', () => showPage('receivePage'));
                document.getElementById('buyCryptoBtn').addEventListener('click', () => showPage('buyCryptoPage'));
                document.getElementById('referralBtn').addEventListener('click', () => showPage('referralPage'));
                document.getElementById('savingsBtn').addEventListener('click', () => showPage('savingsPage'));
                document.getElementById('stakingBtn').addEventListener('click', () => showPage('stakingPage'));
                document.getElementById('launchpadBtn').addEventListener('click', () => showPage('launchpadPage'));
                document.getElementById('moreBtn').addEventListener('click', () => showPage('morePage'));
                document.getElementById('marketsBackBtn').addEventListener('click', () => showPage('homePage'));

                // Header buttons
                document.getElementById('searchAppBtn').addEventListener('click', () => { console.log("This button simulates opening the search modal for the main app."); });
                document.getElementById('notificationsBtn').addEventListener('click', () => showPage('notificationsPage'));
                document.getElementById('settingsBtn').addEventListener('click', () => showPage('settingsPage'));
                
                // Deposit/Withdrawal Modal Logic
                document.getElementById('assetsDepositBtn').addEventListener('click', () => { showModal(depositModal); generateQRCodes(); });
                document.getElementById('assetsWithdrawBtn').addEventListener('click', () => { showModal(withdrawModal); });
                document.getElementById('withdrawMax').addEventListener('click', () => {
                    document.getElementById('withdrawAmount').value = "6878.78";
                });
                document.getElementById('withdrawForm').addEventListener('submit', async (e) => {
                    e.preventDefault();
                    hideAllModals();
                    showModal(withdrawConfirmModal);
                });
                confirmTxBtn.addEventListener('click', () => {
                    const txHash = document.getElementById('txHashInput').value;
                    if (txHash) {
                        hideAllModals();
                        showModal(withdrawProcessingModal);
                        startWithdrawalCountdown();
                    } else {
                        console.error("Please enter a transaction hash.");
                    }
                });

                // QR Code Generation
                const generateQRCodes = () => {
                    const ethQrCodeDiv = document.getElementById('ethQrCode');
                    if (ethQrCodeDiv) {
                        ethQrCodeDiv.innerHTML = '';
                        new QRCode(ethQrCodeDiv, {
                            text: DEPOSIT.ETH,
                            width: 128,
                            height: 128,
                            colorDark : "#fff",
                            colorLight : "#1e2029"
                        });
                    }
                    const btcQrCodeDiv = document.getElementById('btcQrCode');
                    if (btcQrCodeDiv) {
                        btcQrCodeDiv.innerHTML = '';
                        new QRCode(btcQrCodeDiv, {
                            text: DEPOSIT.BTC,
                            width: 128,
                            height: 128,
                            colorDark : "#fff",
                            colorLight : "#1e2029"
                        });
                    }
                };

                const startWithdrawalCountdown = () => {
                    const countdownDisplay = document.getElementById('countdownTimer');
                    let timeRemaining = 24 * 60 * 60; // 24 hours in seconds

                    const timerInterval = setInterval(() => {
                        if (timeRemaining <= 0) {
                            clearInterval(timerInterval);
                            hideAllModals();
                            showModal(withdrawSuccessModal);
                            // Save to transaction history (simulated)
                            console.log("Withdrawal successful, saved to history.");
                            return;
                        }
                        
                        const hours = Math.floor(timeRemaining / 3600);
                        const minutes = Math.floor((timeRemaining % 3600) / 60);
                        const seconds = timeRemaining % 60;
                        countdownDisplay.innerText = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                        
                        timeRemaining--;
                    }, 1000);
                };

                // Fetch and render data for the new homepage
                fetchAndRenderMainAppHome();
            };

            // Modal closing logic
            document.querySelectorAll('.close-modal').forEach(button => {
                button.addEventListener('click', () => {
                    hideAllModals();
                });
            });
            
            // Additional button logic for the landing page
            document.getElementById('getAppBtn').addEventListener('click', () => { console.log("This button simulates opening the App Store."); });
            document.getElementById('exploreMoreBtn').addEventListener('click', () => { console.log("This button simulates navigating to a deeper page or section."); });
            document.getElementById('searchBtn').addEventListener('click', () => { console.log("This button simulates opening the search modal."); });
            
        });
    </script>
</body>
</html>
